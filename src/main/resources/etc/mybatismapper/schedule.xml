<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="schedule">

	<cache />

	<insert id="createSchedule" parameterType="org.uario.seaworkengine.model.Schedule">
		INSERT INTO
		schedule
		(date_schedule, user, editor, controller, from_time, to_time, note)
		VALUES (#{date_schedule}, #{user}, #{editor}, #{controller},
		#{from_time}, #{to_time}, #{note});
	</insert>

	<select id="loadSchedule" resultType="org.uario.seaworkengine.model.Schedule"
		parameterType="int">
		SELECT id, date_schedule, user, editor, controller,
		from_time, to_time, note
		FROM schedule
		WHERE id = #{id};
	</select>

	<select id="selectScheduleByDateAndUser" resultType="org.uario.seaworkengine.model.Schedule"
		parameterType="map">
		SELECT id, date_schedule, user, editor, controller,
		from_time, to_time, note
		FROM schedule
		WHERE user = #{id_user} and
		date_schedule = #{date_schedule};
	</select>

	<select id="loadScheduleByDate" resultType="org.uario.seaworkengine.model.Schedule"
		parameterType="java.util.Date">
		SELECT id, date_schedule, user, editor, controller,
		from_time, to_time, note
		FROM schedule
		WHERE date_schedule =
		#{date_schedule};
		ORDER BY date_schedule desc;
	</select>

	<delete id="removeSchedule" parameterType="int">
		DELETE FROM schedule
		WHERE id = #{id};
	</delete>



	<select id="selectSchedule" resultType="org.uario.seaworkengine.model.Schedule"
		parameterType="map">
	<![CDATA[
select 
    sw.id,
    ds.shift,
    sum(ds.time_initial) as program_time,
    sw.date_schedule,
    sw.note,
    sw.from_time,
    sw.to_time,
    sw.editor,
    sw.controller,
    sw.user,
    sw.name_user
from
    schedule_view sw
        left join
    detail_schedule ds ON (sw.id = ds.id_schedule and (sw.date_schedule >=
		#{date_from} and sw.date_schedule <= #{date_to}))
group by sw.user , sw.id , ds.shift
order by sw.user asc, sw.date_schedule asc;
]]>
	</select>

	<update id="updateSchedule" parameterType="org.uario.seaworkengine.model.Schedule">
		UPDATE schedule
		SET
		id =
		#{id},
		date_schedule = #{date_schedule},
		user = #{user},
		editor =
		#{editor},
		controller = #{controller},
		from_time = #{from_time},
		to_time
		= #{to_time},
		note = #{note}
		WHERE id = #{id};
	</update>

	<insert id="createDetail_Schedule" parameterType="org.uario.seaworkengine.model.DetailSchedule">
		INSERT INTO
		detail_schedule (id_schedule, shift, task_final, task_initial,
		time_final, time_initial)
		VALUES (#{id_schedule}, #{shift},
		#{task_final}, #{task_initial},
		#{time_final}, #{time_initial});
	</insert>

	<select id="loadDetail_Schedule" resultType="org.uario.seaworkengine.model.DetailSchedule"
		parameterType="int">
		SELECT id, id_schedule, shift, task_final, task_initial,
		time_final, time_initial
		FROM detail_schedule
		WHERE id = #{id};
	</select>

	<select id="loadDetail_ScheduleByIdSchedule" resultType="org.uario.seaworkengine.model.DetailSchedule"
		parameterType="map">
		SELECT id, id_schedule, shift, task_final, task_initial,
		time_final, time_initial
		FROM detail_schedule
		WHERE id_schedule =
		#{id_schedule} and shift = #{shift};
	</select>

	<delete id="removeDetail_Schedule" parameterType="int">
		DELETE FROM
		detail_schedule
		WHERE id = #{id};
	</delete>

	<delete id="removeAllDetailScheduleOnSchedule" parameterType="map">
		DELETE FROM
		detail_schedule
		WHERE id_schedule = #{id_schedule} and shift
		= #{shift};
	</delete>

	<update id="updateDetailSchedule" parameterType="org.uario.seaworkengine.model.DetailSchedule">
		UPDATE
		detail_schedule
		SET
		id = #{id},
		id_schedule = #{id_schedule},
		shift =
		#{shift},
		task_final = #{task_final},
		task_initial = #{task_initial},
		time_final = #{time_final},
		time_initial = #{time_initial}
		WHERE id =
		#{id};
	</update>


</mapper>	
	

	
	
	