<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="schedule">

	<cache />

	<insert id="createSchedule" parameterType="org.uario.seaworkengine.model.Schedule">
		INSERT INTO
		schedule
		(date_schedule, user, editor, controller, note)
		VALUES
		(#{date_schedule}, #{user}, #{editor}, #{controller},
		#{note});
	</insert>

	<select id="loadDayScheduleByDate" parameterType="map"
		resultType="org.uario.seaworkengine.model.DaySchedule">
		SELECT id, id_user, shift, date_scheduled
		FROM dayschedule
		WHERE date_scheduled = #{dt_arg};
	</select>




	<select id="selectScheduleByDateAndUser" resultType="org.uario.seaworkengine.model.Schedule"
		parameterType="map">
		SELECT id, date_schedule, user, editor, controller,
		note
		FROM schedule
		WHERE user = #{id_user} and
		date_schedule =
		#{date_schedule};
	</select>






	<select id="selectSchedule" resultType="org.uario.seaworkengine.model.Schedule"
		parameterType="map">
	<![CDATA[
select 
    s.id,
ds.shift,
    sum(ds.time_initial) as program_time,
    s.date_schedule,
    s.note,
    s.editor,
    s.controller,
    u.id as user,
    concat(u.firstname, ' ', u.lastname) AS name_user
from
    user u,
    schedule s left join
    detail_schedule ds ON (s.id = ds.id_schedule)
where
    u.id = s.user and s.date_schedule >= #{date_from} and s.date_schedule < #{date_to}
group by user , s.id , ds.shift
order by user, s.date_schedule asc
]]>
	</select>


	<select id="selectDaySchedulers" resultType="org.uario.seaworkengine.model.DaySchedule"
		parameterType="map">
	<![CDATA[
select s.id, 
u.id as id_user, 
s.shift, 
s.date_scheduled,
    concat(u.firstname, ' ', u.lastname) AS name_user
from
    user u left join
    dayschedule s ON (u.id = s.id_user and s.date_scheduled >= #{date_from} and s.date_scheduled < #{date_to})    

    

]]>
	</select>


	<update id="updateSchedule" parameterType="org.uario.seaworkengine.model.Schedule">
		UPDATE schedule
		SET
		id =
		#{id},
		date_schedule = #{date_schedule},
		user = #{user},
		editor =
		#{editor},
		controller = #{controller},
		note = #{note}
		WHERE id = #{id};
	</update>

	<insert id="createDetail_Schedule" parameterType="org.uario.seaworkengine.model.DetailSchedule">
		INSERT INTO
		detail_schedule (id_schedule, shift, task_final, task_initial,
		time_final, time_initial)
		VALUES (#{id_schedule}, #{shift},
		#{task_final}, #{task_initial},
		#{time_final}, #{time_initial});
	</insert>



	<select id="loadDetail_ScheduleByIdSchedule" resultType="org.uario.seaworkengine.model.DetailSchedule"
		parameterType="map">
		SELECT id, id_schedule, shift, task_final, task_initial,
		time_final, time_initial
		FROM detail_schedule
		WHERE id_schedule =
		#{id_schedule} and shift = #{shift};
	</select>



	<delete id="removeAllDetailScheduleOnSchedule" parameterType="map">
		DELETE FROM
		detail_schedule
		WHERE id_schedule = #{id_schedule} and shift
		= #{shift};
	</delete>





	<insert id="createDaySchedule" parameterType="org.uario.seaworkengine.model.DaySchedule">
		INSERT INTO
		dayschedule (id_user, shift, date_scheduled)
		VALUES (#{id_user},
		#{shift}, #{date_scheduled});
	</insert>

	<select id="loadDaySchedule" parameterType="Integer"
		resultType="org.uario.seaworkengine.model.DaySchedule">
		SELECT id, id_user, shift, date_scheduled
		FROM dayschedule
		WHERE id=#{id};
	</select>


	<update id="updateDaySchedule" parameterType="org.uario.seaworkengine.model.DetailSchedule">
		UPDATE
		dayschedule
		SET
		id_user = #{id_user},
		shift = #{shift},
		date_scheduled =
		#{date_scheduled}
		WHERE id = #{id};
	</update>


</mapper>	
	

	
	
	