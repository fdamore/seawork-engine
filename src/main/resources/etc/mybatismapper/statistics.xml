<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="statistics">

	<cache />



	<select id="selectAvgShiftByUserProgram" resultType="org.uario.seaworkengine.statistics.AverageShift"
		parameterType="map">
		select shift, avg(dis.time) as avg_program_time
		from schedule s,
		detailinitialschedule dis
		where s.user = #{id_user} and s.id =
		dis.id_schedule and s.date_schedule <![CDATA[<=]]>
		#{date_schedule}
		group by dis.shift order by avg_program_time asc

	</select>

	<select id="selectAvgShiftByUserReviewd" resultType="org.uario.seaworkengine.statistics.AverageShift"
		parameterType="map">
		select shift, avg(dis.time) as avg_program_time
		from schedule s,
		detailfinalschedule dis
		where s.user = #{id_user} and s.id =
		dis.id_schedule and s.date_schedule <![CDATA[<=]]>
		#{date_schedule}
		group by dis.shift order by avg_program_time asc

	</select>

	<select id="selectPercentageSunday" resultType="double"
		parameterType="map">
		select
		count(ds.id_user) / (select
		count(dd.id_user)
		from
		dayschedule dd,
		usershift uu
		where
		DAYOFWEEK(dd.date_scheduled) = 1 and uu.presence = 1 and dd.shift =
		uu.id) * 100 as perc
		from
		dayschedule ds,
		usershift us
		where
		ds.shift =
		us.id and us.presence = 1
		and DAYOFWEEK(ds.date_scheduled) = 1
		group by
		id_user
		having id_user = #{id_user}
	</select>



</mapper>