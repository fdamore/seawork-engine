<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="tasks">

	<cache />

	<select id="selectAllTasksByUser" resultType="org.uario.seaworkengine.model.UserTask"
		parameterType="map">
		SELECT t.id,
		t.code,
		t.description,
		ut.task_default
		FROM
		usertask t,
		user_usertask ut where ut.id_user = #{id_user} and
		ut.id_usertask =
		t.id;

	</select>

	<select id="isTaskAssigned" resultType="org.uario.seaworkengine.model.UserTask"
		parameterType="map">
		SELECT t.id,
		t.code,
		t.description
		FROM usertask t,
		user_usertask ut where t.id = ut.id_user and ut.id_user = #{id_user}
		and ut.id_usertask =
		#{id_task};

	</select>

	<insert id="assignTaskToUser" parameterType="map">
		INSERT INTO
		user_usertask
		(id_user,
		id_usertask)
		VALUES
		(#{id_user},#{id_task});

	</insert>

	<update id="setAsDefault" parameterType="map">

		UPDATE user_usertask set
		task_default = 1
		where id_user = #{id_user} and id_usertask =
		#{id_usertask};

	</update>

	<select id="getDefault" parameterType="Integer"
		resultType="org.uario.seaworkengine.model.UserTask">

		SELECT t.id,
		t.code,
		t.description
		FROM user_usertask ut, usertask t
		WHERE
		ut.task_default = 1 and ut.id_user = #{id_user} and t.id =
		ut.id_usertask

	</select>

	<update id="removeAllDefault" parameterType="map">

		UPDATE user_usertask
		set
		task_default = 0
		where id_user = #{id_user};

	</update>

	<delete id="deleteTaskToUser" parameterType="map">
		delete from
		user_usertask where
		id_usertask = #{id_usertask} and id_user =
		#{id_user}
	</delete>

</mapper>