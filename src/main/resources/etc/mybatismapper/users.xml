<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="person">

	<cache-ref namespace="schedule" />


	<select id="user_report" resultType="org.uario.seaworkengine.utility.UserReport">
	<![CDATA[
SELECT 
    lastname,
    firstname,
    status,
    department,
    ncfl,
    birth_place,
    birth_date,
    address,
    city,
    zip,
    provincia,
    phone,
    fiscal_code,
    marital_status,
    family_charge,
    employee_identification,
    npass,
    nbudge,
    personal_code,
    education,
    driving_license,
    driving_license_emission,
    contractual_level,
    current_position,
    (SELECT 
            b.description
        FROM
            job_cost j,
            billcenter b
        WHERE
            j.bill_center = b.id AND id_user = u.id
                AND (date_to IS NULL
                OR date_to = (SELECT 
                    MAX(date_to)
                FROM
                    job_cost j1
                WHERE
                    j1.id_user = u.id))
        LIMIT 1) jobcost,
    (SELECT 
            j.awards
        FROM
            job_cost j,
            billcenter b
        WHERE
            j.bill_center = b.id AND id_user = u.id
                AND (date_to IS NULL
                OR date_to = (SELECT 
                    MAX(date_to)
                FROM
                    job_cost j1
                WHERE
                    j1.id_user = u.id))
        LIMIT 1) job_awards,
       (SELECT 
            j.date_from
        FROM
            job_cost j,
            billcenter b
        WHERE
            j.bill_center = b.id AND id_user = u.id
                AND (date_to IS NULL
                OR date_to = (SELECT 
                    MAX(date_to)
                FROM
                    job_cost j1
                WHERE
                    j1.id_user = u.id))
        LIMIT 1) job_date_from,
    (SELECT 
            j.date_to
        FROM
            job_cost j,
            billcenter b
        WHERE
            j.bill_center = b.id AND id_user = u.id
                AND (date_to IS NULL
                OR date_to = (SELECT 
                    MAX(date_to)
                FROM
                    job_cost j1
                WHERE
                    j1.id_user = u.id))
        LIMIT 1) job_date_to,
    (SELECT 
            j.basicsalary
        FROM
            job_cost j,
            billcenter b
        WHERE
            j.bill_center = b.id AND id_user = u.id
                AND (date_to IS NULL
                OR date_to = (SELECT 
                    MAX(date_to)
                FROM
                    job_cost j1
                WHERE
                    j1.id_user = u.id))
        LIMIT 1) job_basicsalary,
    (SELECT 
            j.contingency
        FROM
            job_cost j,
            billcenter b
        WHERE
            j.bill_center = b.id AND id_user = u.id
                AND (date_to IS NULL
                OR date_to = (SELECT 
                    MAX(date_to)
                FROM
                    job_cost j1
                WHERE
                    j1.id_user = u.id))
        LIMIT 1) job_contingency,
    (SELECT 
            j.shots
        FROM
            job_cost j,
            billcenter b
        WHERE
            j.bill_center = b.id AND id_user = u.id
                AND (date_to IS NULL
                OR date_to = (SELECT 
                    MAX(date_to)
                FROM
                    job_cost j1
                WHERE
                    j1.id_user = u.id))
        LIMIT 1) job_shots,
    (SELECT 
            j.edr
        FROM
            job_cost j,
            billcenter b
        WHERE
            j.bill_center = b.id AND id_user = u.id
                AND (date_to IS NULL
                OR date_to = (SELECT 
                    MAX(date_to)
                FROM
                    job_cost j1
                WHERE
                    j1.id_user = u.id))
        LIMIT 1) job_edr,
    (SELECT 
            CONCAT(t.code, ' - ', t.description)
        FROM
            usertask t,
            user_usertask ut
        WHERE
            ut.id_user = u.id
                AND ut.task_default = 1
                AND ut.id_usertask = t.id
        LIMIT 1) task_default,
    (SELECT 
            tfr.tfr_destination
        FROM
            tfruser tfr
        WHERE
            tfr.id_user = u.id
                AND (tfr.tfr_selection_date IS NULL
                OR tfr.tfr_selection_date = (SELECT 
                    MAX(tfr1.tfr_selection_date)
                FROM
                    tfruser tfr1
                WHERE
                    tfr1.id_user = u.id))
        LIMIT 1) tfr_destination,
    (SELECT 
            tfr.tfr_selection_date
        FROM
            tfruser tfr
        WHERE
            tfr.id_user = u.id
                AND (tfr.tfr_selection_date IS NULL
                OR tfr.tfr_selection_date = (SELECT 
                    MAX(tfr1.tfr_selection_date)
                FROM
                    tfruser tfr1
                WHERE
                    tfr1.id_user = u.id))
        LIMIT 1) tfr_selection_date,
    (SELECT 
            fc.request_date
        FROM
            fiscalcontrol fc
        WHERE
            fc.id_user = u.id
                AND (fc.request_date = (SELECT 
                    MAX(fc1.request_date)
                FROM
                    fiscalcontrol fc1
                WHERE
                    fc1.id_user = u.id))
        LIMIT 1) fc_request_date,
    (SELECT 
            fc.control_date
        FROM
            fiscalcontrol fc
        WHERE
            fc.id_user = u.id
                AND (fc.request_date = (SELECT 
                    MAX(fc1.request_date)
                FROM
                    fiscalcontrol fc1
                WHERE
                    fc1.id_user = u.id))
        LIMIT 1) fc_control_date,
    (SELECT 
            fc.sikness_from
        FROM
            fiscalcontrol fc
        WHERE
            fc.id_user = u.id
                AND (fc.request_date = (SELECT 
                    MAX(fc1.request_date)
                FROM
                    fiscalcontrol fc1
                WHERE
                    fc1.id_user = u.id))
        LIMIT 1) fc_sikness_from,
    (SELECT 
            fc.sikness_to
        FROM
            fiscalcontrol fc
        WHERE
            fc.id_user = u.id
                AND (fc.request_date = (SELECT 
                    MAX(fc1.request_date)
                FROM
                    fiscalcontrol fc1
                WHERE
                    fc1.id_user = u.id))
        LIMIT 1) fc_sikness_to,
    (SELECT 
            fc.sede_inps
        FROM
            fiscalcontrol fc
        WHERE
            fc.id_user = u.id
                AND (fc.request_date = (SELECT 
                    MAX(fc1.request_date)
                FROM
                    fiscalcontrol fc1
                WHERE
                    fc1.id_user = u.id))
        LIMIT 1) fc_sede_inps,
    (SELECT 
            fc.result
        FROM
            fiscalcontrol fc
        WHERE
            fc.id_user = u.id
                AND (fc.request_date = (SELECT 
                    MAX(fc1.request_date)
                FROM
                    fiscalcontrol fc1
                WHERE
                    fc1.id_user = u.id))
        LIMIT 1) fc_result,
    (SELECT 
            fc.result_comunication_type
        FROM
            fiscalcontrol fc
        WHERE
            fc.id_user = u.id
                AND (fc.request_date = (SELECT 
                    MAX(fc1.request_date)
                FROM
                    fiscalcontrol fc1
                WHERE
                    fc1.id_user = u.id))
        LIMIT 1) fc_result_type,
    (SELECT 
            me.date_examination
        FROM
            medicalexamination me
        WHERE
            me.iduser = u.id
                AND (me.date_examination = (SELECT 
                    MAX(me1.date_examination)
                FROM
                    medicalexamination me1
                WHERE
                    me1.iduser = u.id))
        LIMIT 1) me_date_examination,
    (SELECT 
            me.next_date_examination
        FROM
            medicalexamination me
        WHERE
            me.iduser = u.id
                AND (me.date_examination = (SELECT 
                    MAX(me1.date_examination)
                FROM
                    medicalexamination me1
                WHERE
                    me1.iduser = u.id))
        LIMIT 1) me_next_date_examination,
    (SELECT 
            me.result_examination
        FROM
            medicalexamination me
        WHERE
            me.iduser = u.id
                AND (me.date_examination = (SELECT 
                    MAX(me1.date_examination)
                FROM
                    medicalexamination me1
                WHERE
                    me1.iduser = u.id))
        LIMIT 1) me_result_examination,
    (SELECT 
            me.prescriptions
        FROM
            medicalexamination me
        WHERE
            me.iduser = u.id
                AND (me.date_examination = (SELECT 
                    MAX(me1.date_examination)
                FROM
                    medicalexamination me1
                WHERE
                    me1.iduser = u.id))
        LIMIT 1) me_prescriptions,
    (SELECT 
            tu.name
        FROM
            tradeunion tu
        WHERE
            tu.id_user = u.id
                AND (tu.registration = (SELECT 
                    MAX(tu1.registration)
                FROM
                    tradeunion tu1
                WHERE
                    tu1.id_user = u.id))
        LIMIT 1) tu_name,
    (SELECT 
            tu.registration
        FROM
            tradeunion tu
        WHERE
            tu.id_user = u.id
                AND (tu.registration = (SELECT 
                    MAX(tu1.registration)
                FROM
                    tradeunion tu1
                WHERE
                    tu1.id_user = u.id))
        LIMIT 1) tu_registration,
    (SELECT 
            tu.cancellation
        FROM
            tradeunion tu
        WHERE
            tu.id_user = u.id
                AND (tu.registration = (SELECT 
                    MAX(tu1.registration)
                FROM
                    tradeunion tu1
                WHERE
                    tu1.id_user = u.id))
        LIMIT 1) tu_cancellation,
    (SELECT 
            con.date_contestation
        FROM
            contestation con
        WHERE
            con.id_user = u.id
                AND (con.date_contestation = (SELECT 
                    MAX(con1.date_contestation)
                FROM
                    contestation con1
                WHERE
                    con1.id_user = u.id))
        LIMIT 1) con_date_contestation,
    (SELECT 
            con.date_penalty
        FROM
            contestation con
        WHERE
            con.id_user = u.id
                AND (con.date_contestation = (SELECT 
                    MAX(con1.date_contestation)
                FROM
                    contestation con1
                WHERE
                    con1.id_user = u.id))
        LIMIT 1) con_date_penality,
    (SELECT 
            con.typ
        FROM
            contestation con
        WHERE
            con.id_user = u.id
                AND (con.date_contestation = (SELECT 
                    MAX(con1.date_contestation)
                FROM
                    contestation con1
                WHERE
                    con1.id_user = u.id))
        LIMIT 1) con_typ,
    (SELECT 
            con.stop_from
        FROM
            contestation con
        WHERE
            con.id_user = u.id
                AND (con.date_contestation = (SELECT 
                    MAX(con1.date_contestation)
                FROM
                    contestation con1
                WHERE
                    con1.id_user = u.id))
        LIMIT 1) con_stop_from,
    (SELECT 
            con.stop_to
        FROM
            contestation con
        WHERE
            con.id_user = u.id
                AND (con.date_contestation = (SELECT 
                    MAX(con1.date_contestation)
                FROM
                    contestation con1
                WHERE
                    con1.id_user = u.id))
        LIMIT 1) con_stop_to,
    (SELECT 
            con.recall
        FROM
            contestation con
        WHERE
            con.id_user = u.id
                AND (con.date_contestation = (SELECT 
                    MAX(con1.date_contestation)
                FROM
                    contestation con1
                WHERE
                    con1.id_user = u.id))
        LIMIT 1) con_recall,
    (SELECT 
            con.recall
        FROM
            contestation con
        WHERE
            con.id_user = u.id
                AND (con.date_contestation = (SELECT 
                    MAX(con1.date_contestation)
                FROM
                    contestation con1
                WHERE
                    con1.id_user = u.id))
        LIMIT 1) con_recall,
    (SELECT 
            con.date_bp
        FROM
            contestation con
        WHERE
            con.id_user = u.id
                AND (con.date_contestation = (SELECT 
                    MAX(con1.date_contestation)
                FROM
                    contestation con1
                WHERE
                    con1.id_user = u.id))
        LIMIT 1) con_datebp,
    (SELECT 
            con.prot
        FROM
            contestation con
        WHERE
            con.id_user = u.id
                AND (con.date_contestation = (SELECT 
                    MAX(con1.date_contestation)
                FROM
                    contestation con1
                WHERE
                    con1.id_user = u.id))
        LIMIT 1) con_prot,
    (SELECT 
            con.prot_penalty
        FROM
            contestation con
        WHERE
            con.id_user = u.id
                AND (con.date_contestation = (SELECT 
                    MAX(con1.date_contestation)
                FROM
                    contestation con1
                WHERE
                    con1.id_user = u.id))
        LIMIT 1) con_prot_penalty,
    (SELECT 
            uc.date_submit
        FROM
            user_compensation uc
        WHERE
            uc.id_user = u.id
                AND (uc.date_submit = (SELECT 
                    MAX(uc1.date_submit)
                FROM
                    user_compensation uc1
                WHERE
                    uc1.id_user = u.id))
        LIMIT 1) uc_date_submit,
    (SELECT 
            uc.time_comp
        FROM
            user_compensation uc
        WHERE
            uc.id_user = u.id
                AND (uc.date_submit = (SELECT 
                    MAX(uc1.date_submit)
                FROM
                    user_compensation uc1
                WHERE
                    uc1.id_user = u.id))
        LIMIT 1) uc_time_comp,
    (SELECT 
            tc.certificate_date
        FROM
            training_certificate tc
        WHERE
            tc.user_id = u.id
                AND (tc.certificate_date = (SELECT 
                    MAX(tc1.certificate_date)
                FROM
                    training_certificate tc1
                WHERE
                    tc1.user_id = u.id))
        LIMIT 1) tc_certificate_date,
    (SELECT 
            tc.title
        FROM
            training_certificate tc
        WHERE
            tc.user_id = u.id
                AND (tc.certificate_date = (SELECT 
                    MAX(tc1.certificate_date)
                FROM
                    training_certificate tc1
                WHERE
                    tc1.user_id = u.id))
        LIMIT 1) tc_title,
    (SELECT 
            tc.expiration_date
        FROM
            training_certificate tc
        WHERE
            tc.user_id = u.id
                AND (tc.certificate_date = (SELECT 
                    MAX(tc1.certificate_date)
                FROM
                    training_certificate tc1
                WHERE
                    tc1.user_id = u.id))
        LIMIT 1) tc_expiration_date,
    (SELECT 
            tc.trainer_type
        FROM
            training_certificate tc
        WHERE
            tc.user_id = u.id
                AND (tc.certificate_date = (SELECT 
                    MAX(tc1.certificate_date)
                FROM
                    training_certificate tc1
                WHERE
                    tc1.user_id = u.id))
        LIMIT 1) tc_trainer_type,
    (SELECT 
            tc.trainer
        FROM
            training_certificate tc
        WHERE
            tc.user_id = u.id
                AND (tc.certificate_date = (SELECT 
                    MAX(tc1.certificate_date)
                FROM
                    training_certificate tc1
                WHERE
                    tc1.user_id = u.id))
        LIMIT 1) tc_trainer,
    (SELECT 
            tc.training_task
        FROM
            training_certificate tc
        WHERE
            tc.user_id = u.id
                AND (tc.certificate_date = (SELECT 
                    MAX(tc1.certificate_date)
                FROM
                    training_certificate tc1
                WHERE
                    tc1.user_id = u.id))
        LIMIT 1) tc_training_task,
    (SELECT 
            tc.training_level
        FROM
            training_certificate tc
        WHERE
            tc.user_id = u.id
                AND (tc.certificate_date = (SELECT 
                    MAX(tc1.certificate_date)
                FROM
                    training_certificate tc1
                WHERE
                    tc1.user_id = u.id))
        LIMIT 1) tc_training_level,
    (SELECT 
            tc.typ
        FROM
            training_certificate tc
        WHERE
            tc.user_id = u.id
                AND (tc.certificate_date = (SELECT 
                    MAX(tc1.certificate_date)
                FROM
                    training_certificate tc1
                WHERE
                    tc1.user_id = u.id))
        LIMIT 1) tc_typ,
    (SELECT 
            tc.tutor
        FROM
            training_certificate tc
        WHERE
            tc.user_id = u.id
                AND (tc.certificate_date = (SELECT 
                    MAX(tc1.certificate_date)
                FROM
                    training_certificate tc1
                WHERE
                    tc1.user_id = u.id))
        LIMIT 1) tc_tutor,
    (SELECT 
            tc.start_class
        FROM
            training_certificate tc
        WHERE
            tc.user_id = u.id
                AND (tc.certificate_date = (SELECT 
                    MAX(tc1.certificate_date)
                FROM
                    training_certificate tc1
                WHERE
                    tc1.user_id = u.id))
        LIMIT 1) tc_start_class,
    (SELECT 
            tc.end_class
        FROM
            training_certificate tc
        WHERE
            tc.user_id = u.id
                AND (tc.certificate_date = (SELECT 
                    MAX(tc1.certificate_date)
                FROM
                    training_certificate tc1
                WHERE
                    tc1.user_id = u.id))
        LIMIT 1) tc_end_class,
    (SELECT 
            tc.duration
        FROM
            training_certificate tc
        WHERE
            tc.user_id = u.id
                AND (tc.certificate_date = (SELECT 
                    MAX(tc1.certificate_date)
                FROM
                    training_certificate tc1
                WHERE
                    tc1.user_id = u.id))
        LIMIT 1) tc_duration
FROM
    user u
]]>
	</select>




	<select id="listAllPersonByEnable" resultType="org.uario.seaworkengine.model.Person">
<![CDATA[
SELECT 
    u.id,
    u.enabled,
    u.email,
    u.password,
    u.authority,
    u.firstname,
    u.lastname,
    u.address,
    u.city,
    u.zip,
    u.phone,
    u.country,
    u.birth_date,
    u.birth_place,
    u.current_position,
    u.department,
    u.driving_license,
    u.driving_license_emission,
    u.education,
    u.employee_identification,
    u.family_charge,
    u.fiscal_code,
    u.marital_status,
    u.nbudge,
    u.ncfl,
    u.npass,
    u.provincia,
    u.status,
    u.personal_code,
    u.sex,
    u.out_schedule,
    u.birth_province,
    u.dailyemployee,
    u.part_time,
    u.daywork_w,
    u.hourswork_w,
    u.contractual_level,
    (SELECT 
            GROUP_CONCAT(ut.description)
        FROM
            usertask ut,
            user_usertask u_t
        WHERE
            u.id = u_t.id_user
                AND u_t.id_usertask = ut.id
                AND ut.internal = 0) AS tasksPerson
FROM
    user u
WHERE
    u.enabled = #{enable}
ORDER BY u.status ASC
]]>
	</select>

	<select id="listAllPersonByUserTask" resultType="org.uario.seaworkengine.model.Person">
<![CDATA[


SELECT 
    u.id,
		u.enabled,
		u.email,
		u.password,
		u.authority,
		u.firstname,
		u.lastname,
		u.address,
		u.city,
		u.zip,
		u.phone,
		u.country,
		u.birth_date,
		u.birth_place,
		u.current_position,
		u.department,
		u.driving_license,
		u.driving_license_emission,
		u.education,
		u.employee_identification,
		u.family_charge,
		u.fiscal_code,
		u.marital_status,
		u.nbudge,
		u.ncfl,
		u.npass,
		u.provincia,
		u.status,
		u.personal_code,
		u.sex,
		u.out_schedule,
		u.birth_province,
		u.dailyemployee,
		u.part_time,
		u.daywork_w,
		u.hourswork_w,
		u.contractual_level, (		
			select GROUP_CONCAT(ut.description) FROM usertask ut, user_usertask u_t 
				WHERE 
				u.id = u_t.id_user and u_t.id_usertask=ut.id and ut.internal=0 ) as tasksPerson
FROM
    user u,
    usertask ut,
    user_usertask u_ut
WHERE
    u.id = u_ut.id_user
        AND u_ut.id_usertask = ut.id
        AND ut.id = #{id_usertask}
		
		]]>

	</select>

	<select id="listAllPersonByCurrentPosition" resultType="org.uario.seaworkengine.model.Person">
<![CDATA[
SELECT 
    u.id,
    u.enabled,
    u.email,
    u.password,
    u.authority,
    u.firstname,
    u.lastname,
    u.address,
    u.city,
    u.zip,
    u.phone,
    u.country,
    u.birth_date,
    u.birth_place,
    u.current_position,
    u.department,
    u.driving_license,
    u.driving_license_emission,
    u.education,
    u.employee_identification,
    u.family_charge,
    u.fiscal_code,
    u.marital_status,
    u.nbudge,
    u.ncfl,
    u.npass,
    u.provincia,
    u.status,
    u.personal_code,
    u.sex,
    u.out_schedule,
    u.birth_province,
    u.dailyemployee,
    u.part_time,
    u.daywork_w,
    u.hourswork_w,
    u.contractual_level,
    (SELECT 
            GROUP_CONCAT(ut.description)
        FROM
            usertask ut,
            user_usertask u_t
        WHERE
            u.id = u_t.id_user
                AND u_t.id_usertask = ut.id
                AND ut.internal = 0) AS tasksPerson
FROM
    user u
WHERE
    u.current_position LIKE CONCAT('%', #{current_position}, '%')
ORDER BY u.status ASC		
		]]>
	</select>

	<select id="usersAdmin" resultType="org.uario.seaworkengine.model.Person">
<![CDATA[
SELECT 
    u.id,
    u.enabled,
    u.email,
    u.password,
    u.authority,
    u.firstname,
    u.lastname,
    u.address,
    u.city,
    u.zip,
    u.phone,
    u.country,
    u.birth_date,
    u.birth_place,
    u.current_position,
    u.department,
    u.driving_license,
    u.driving_license_emission,
    u.education,
    u.employee_identification,
    u.family_charge,
    u.fiscal_code,
    u.marital_status,
    u.nbudge,
    u.ncfl,
    u.npass,
    u.provincia,
    u.status,
    u.personal_code,
    u.sex,
    u.out_schedule,
    u.birth_province,
    u.dailyemployee,
    u.part_time,
    u.daywork_w,
    u.hourswork_w,
    u.contractual_level,
    (SELECT 
            GROUP_CONCAT(ut.description)
        FROM
            usertask ut,
            user_usertask u_t
        WHERE
            u.id = u_t.id_user
                AND u_t.id_usertask = ut.id
                AND ut.internal = 0) AS tasksPerson
FROM
    user u
WHERE
    (u.authority LIKE CONCAT('%', 'ROLE_SUPERVISOR', '%'))
ORDER BY u.status ASC
]]>
	</select>

	<select id="usersOperative" resultType="org.uario.seaworkengine.model.Person">
<![CDATA[
SELECT 
    u.id,
    u.enabled,
    u.email,
    u.password,
    u.authority,
    u.firstname,
    u.lastname,
    u.address,
    u.city,
    u.zip,
    u.phone,
    u.country,
    u.birth_date,
    u.birth_place,
    u.current_position,
    u.department,
    u.driving_license,
    u.driving_license_emission,
    u.education,
    u.employee_identification,
    u.family_charge,
    u.fiscal_code,
    u.marital_status,
    u.nbudge,
    u.ncfl,
    u.npass,
    u.provincia,
    u.status,
    u.personal_code,
    u.sex,
    u.out_schedule,
    u.birth_province,
    u.dailyemployee,
    u.part_time,
    u.daywork_w,
    u.hourswork_w,
    u.contractual_level,
    (SELECT 
            GROUP_CONCAT(ut.description)
        FROM
            usertask ut,
            user_usertask u_t
        WHERE
            u.id = u_t.id_user
                AND u_t.id_usertask = ut.id
                AND ut.internal = 0) AS tasksPerson
FROM
    user u
WHERE
    (u.authority LIKE CONCAT('%', 'ROLE_OPERATIVE', '%'))
ORDER BY u.status ASC
]]>
	</select>


	<select id="listPersonInSchedule" resultType="org.uario.seaworkengine.model.Person">
<![CDATA[
SELECT 
    u.id,
    u.enabled,
    u.email,
    u.password,
    u.authority,
    u.firstname,
    u.lastname,
    u.address,
    u.city,
    u.zip,
    u.phone,
    u.country,
    u.birth_date,
    u.birth_place,
    u.current_position,
    u.department,
    u.driving_license,
    u.driving_license_emission,
    u.education,
    u.employee_identification,
    u.family_charge,
    u.fiscal_code,
    u.marital_status,
    u.nbudge,
    u.ncfl,
    u.npass,
    u.provincia,
    u.status,
    u.personal_code,
    u.sex,
    u.out_schedule,
    u.birth_province,
    u.dailyemployee,
    u.part_time,
    u.daywork_w,
    u.hourswork_w,
    u.contractual_level
FROM
    user u
WHERE
    u.out_schedule = 0
ORDER BY u.firstname ASC
]]>
	</select>


	<select id="listViewerEmployee" resultType="org.uario.seaworkengine.model.Person">
<![CDATA[
SELECT 
    u.id,
    u.enabled,
    u.email,
    u.password,
    u.authority,
    u.firstname,
    u.lastname,
    u.address,
    u.city,
    u.zip,
    u.phone,
    u.country,
    u.birth_date,
    u.birth_place,
    u.current_position,
    u.department,
    u.driving_license,
    u.driving_license_emission,
    u.education,
    u.employee_identification,
    u.family_charge,
    u.fiscal_code,
    u.marital_status,
    u.nbudge,
    u.ncfl,
    u.npass,
    u.provincia,
    u.status,
    u.personal_code,
    u.sex,
    u.out_schedule,
    u.birth_province,
    u.dailyemployee,
    u.part_time,
    u.daywork_w,
    u.hourswork_w,
    u.contractual_level,
    (SELECT 
            GROUP_CONCAT(ut.description)
        FROM
            usertask ut,
            user_usertask u_t
        WHERE
            u.id = u_t.id_user
                AND u_t.id_usertask = ut.id
                AND ut.internal = 0) AS tasksPerson
FROM
    user u
WHERE
    (u.authority LIKE CONCAT('%', 'ROLE_VIEWER', '%'))
ORDER BY u.status ASC
]]>
	</select>

	<select id="listProgrammerEmployee" resultType="org.uario.seaworkengine.model.Person">
<![CDATA[
SELECT 
    u.id,
    u.enabled,
    u.email,
    u.password,
    u.authority,
    u.firstname,
    u.lastname,
    u.address,
    u.city,
    u.zip,
    u.phone,
    u.country,
    u.birth_date,
    u.birth_place,
    u.current_position,
    u.department,
    u.driving_license,
    u.driving_license_emission,
    u.education,
    u.employee_identification,
    u.family_charge,
    u.fiscal_code,
    u.marital_status,
    u.nbudge,
    u.ncfl,
    u.npass,
    u.provincia,
    u.status,
    u.personal_code,
    u.sex,
    u.out_schedule,
    u.birth_province,
    u.dailyemployee,
    u.part_time,
    u.daywork_w,
    u.hourswork_w,
    u.contractual_level,
    (SELECT 
            GROUP_CONCAT(ut.description)
        FROM
            usertask ut,
            user_usertask u_t
        WHERE
            u.id = u_t.id_user
                AND u_t.id_usertask = ut.id
                AND ut.internal = 0) AS tasksPerson
FROM
    user u
WHERE
    (u.authority LIKE CONCAT('%', 'ROLE_BACKOFFICE', '%'))
ORDER BY u.status ASC
]]>
	</select>

	<select id="listOutScheduleEmployee" resultType="org.uario.seaworkengine.model.Person">
<![CDATA[
SELECT 
    u.id,
    u.enabled,
    u.email,
    u.password,
    u.authority,
    u.firstname,
    u.lastname,
    u.address,
    u.city,
    u.zip,
    u.phone,
    u.country,
    u.birth_date,
    u.birth_place,
    u.current_position,
    u.department,
    u.driving_license,
    u.driving_license_emission,
    u.education,
    u.employee_identification,
    u.family_charge,
    u.fiscal_code,
    u.marital_status,
    u.nbudge,
    u.ncfl,
    u.npass,
    u.provincia,
    u.status,
    u.personal_code,
    u.sex,
    u.out_schedule,
    u.birth_province,
    u.dailyemployee,
    u.part_time,
    u.daywork_w,
    u.hourswork_w,
    u.contractual_level,
    (SELECT 
            GROUP_CONCAT(ut.description)
        FROM
            usertask ut,
            user_usertask u_t
        WHERE
            u.id = u_t.id_user
                AND u_t.id_usertask = ut.id
                AND ut.internal = 0) AS tasksPerson
FROM
    user u
WHERE
    u.out_schedule = 1
ORDER BY u.firstname ASC
]]>
	</select>

	<select id="listAllPersonByUserStatusPeriod" parameterType="map"
		resultType="org.uario.seaworkengine.model.Person">		
	<![CDATA[		
SELECT 
    u.id,
		u.enabled,
		u.email,
		u.password,
		u.authority,
		u.firstname,
		u.lastname,
		u.address,
		u.city,
		u.zip,
		u.phone,
		u.country,
		u.birth_date,
		u.birth_place,
		u.current_position,
		u.department,
		u.driving_license,
		u.driving_license_emission,
		u.education,
		u.employee_identification,
		u.family_charge,
		u.fiscal_code,
		u.marital_status,
		u.nbudge,
		u.ncfl,
		u.npass,
		u.provincia,
		u.status,
		u.personal_code,
		u.sex,
		u.out_schedule,
		u.birth_province,
		u.dailyemployee,
		u.part_time,
		u.daywork_w,
		u.hourswork_w,
		u.contractual_level, (
		select GROUP_CONCAT(ut.description) FROM
		usertask ut, user_usertask u_t WHERE u.id = u_t.id_user and
		u_t.id_usertask=ut.id and ut.internal=0
		) as tasksPerson
FROM
    user u,
    employment e
where
    e.status = #{userStatus} and e.id_user = u.id
    ]]>

		<if test="from != null">
			<![CDATA[ and date(e.date_modified) >= #{from} ]]>
		</if>

		<if test="to != null">
			<![CDATA[ and date(e.date_end) <= #{to} ]]>
		</if>
<![CDATA[ order by u.firstname asc]]>

	</select>



	<select id="listAllPersonByUserStatus" parameterType="String"
		resultType="org.uario.seaworkengine.model.Person">
<![CDATA[
SELECT 
    u.id,
    u.enabled,
    u.email,
    u.password,
    u.authority,
    u.firstname,
    u.lastname,
    u.address,
    u.city,
    u.zip,
    u.phone,
    u.country,
    u.birth_date,
    u.birth_place,
    u.current_position,
    u.department,
    u.driving_license,
    u.driving_license_emission,
    u.education,
    u.employee_identification,
    u.family_charge,
    u.fiscal_code,
    u.marital_status,
    u.nbudge,
    u.ncfl,
    u.npass,
    u.provincia,
    u.status,
    u.personal_code,
    u.sex,
    u.out_schedule,
    u.birth_province,
    u.dailyemployee,
    u.part_time,
    u.daywork_w,
    u.hourswork_w,
    u.contractual_level,
    (SELECT 
            GROUP_CONCAT(ut.description)
        FROM
            usertask ut,
            user_usertask u_t
        WHERE
            u.id = u_t.id_user
                AND u_t.id_usertask = ut.id
                AND ut.internal = 0) AS tasksPerson
FROM
    user u
WHERE
    u.status = #{userStatus}
ORDER BY u.firstname ASC
]]>

	</select>

	<select id="listAllPersonByContractualLevel" parameterType="Integer"
		resultType="org.uario.seaworkengine.model.Person">
<![CDATA[
		SELECT 
    u.id,
    u.enabled,
    u.email,
    u.password,
    u.authority,
    u.firstname,
    u.lastname,
    u.address,
    u.city,
    u.zip,
    u.phone,
    u.country,
    u.birth_date,
    u.birth_place,
    u.current_position,
    u.department,
    u.driving_license,
    u.driving_license_emission,
    u.education,
    u.employee_identification,
    u.family_charge,
    u.fiscal_code,
    u.marital_status,
    u.nbudge,
    u.ncfl,
    u.npass,
    u.provincia,
    u.status,
    u.personal_code,
    u.sex,
    u.out_schedule,
    u.birth_province,
    u.dailyemployee,
    u.part_time,
    u.daywork_w,
    u.hourswork_w,
    u.contractual_level,
    (SELECT 
            GROUP_CONCAT(ut.description)
        FROM
            usertask ut,
            user_usertask u_t
        WHERE
            u.id = u_t.id_user
                AND u_t.id_usertask = ut.id
                AND ut.internal = 0) AS tasksPerson
FROM
    user u
WHERE
    u.contractual_level = #{contractual_level}
ORDER BY u.firstname ASC
]]>

	</select>

	<select id="listAllPartTime" resultType="org.uario.seaworkengine.model.Person">
<![CDATA[
SELECT 
    u.id,
    u.enabled,
    u.email,
    u.password,
    u.authority,
    u.firstname,
    u.lastname,
    u.address,
    u.city,
    u.zip,
    u.phone,
    u.country,
    u.birth_date,
    u.birth_place,
    u.current_position,
    u.department,
    u.driving_license,
    u.driving_license_emission,
    u.education,
    u.employee_identification,
    u.family_charge,
    u.fiscal_code,
    u.marital_status,
    u.nbudge,
    u.ncfl,
    u.npass,
    u.provincia,
    u.status,
    u.personal_code,
    u.sex,
    u.out_schedule,
    u.birth_province,
    u.dailyemployee,
    u.part_time,
    u.daywork_w,
    u.hourswork_w,
    u.contractual_level,
    (SELECT 
            GROUP_CONCAT(ut.description)
        FROM
            usertask ut,
            user_usertask u_t
        WHERE
            u.id = u_t.id_user
                AND u_t.id_usertask = ut.id
                AND ut.internal = 0) AS tasksPerson
FROM
    user u
WHERE
    u.part_time = 1
ORDER BY u.firstname ASC
]]>
	</select>


	<select id="listDailyEmployee" resultType="org.uario.seaworkengine.model.Person">
<![CDATA[
SELECT 
    u.id,
    u.enabled,
    u.email,
    u.password,
    u.authority,
    u.firstname,
    u.lastname,
    u.address,
    u.city,
    u.zip,
    u.phone,
    u.country,
    u.birth_date,
    u.birth_place,
    u.current_position,
    u.department,
    u.driving_license,
    u.driving_license_emission,
    u.education,
    u.employee_identification,
    u.family_charge,
    u.fiscal_code,
    u.marital_status,
    u.nbudge,
    u.ncfl,
    u.npass,
    u.provincia,
    u.status,
    u.personal_code,
    u.sex,
    u.out_schedule,
    u.birth_province,
    u.dailyemployee,
    u.part_time,
    u.daywork_w,
    u.hourswork_w,
    u.contractual_level,
    (SELECT 
            GROUP_CONCAT(ut.description)
        FROM
            usertask ut,
            user_usertask u_t
        WHERE
            u.id = u_t.id_user
                AND u_t.id_usertask = ut.id
                AND ut.internal = 0) AS tasksPerson
FROM
    user u
WHERE
    u.dailyemployee = 1
ORDER BY u.firstname ASC
]]>
	</select>


	<select id="selectUsersByUsername" parameterType="string"
		resultType="org.uario.seaworkengine.model.Person">
<![CDATA[
SELECT 
    u.id,
    u.enabled,
    u.email,
    u.password,
    u.authority,
    u.firstname,
    u.lastname,
    u.address,
    u.city,
    u.zip,
    u.phone,
    u.country,
    u.birth_date,
    u.birth_place,
    u.current_position,
    u.department,
    u.driving_license,
    u.driving_license_emission,
    u.education,
    u.employee_identification,
    u.family_charge,
    u.fiscal_code,
    u.marital_status,
    u.nbudge,
    u.ncfl,
    u.npass,
    u.provincia,
    u.status,
    u.personal_code,
    u.sex,
    u.out_schedule,
    u.birth_province,
    u.dailyemployee,
    u.part_time,
    u.daywork_w,
    u.hourswork_w,
    u.contractual_level
FROM
    user u
WHERE
    u.email = #{username}
ORDER BY u.status ASC
]]>
	</select>

	<select id="selectUsersByUsernameAndPassword" parameterType="string"
		resultType="org.uario.seaworkengine.model.Person">
<![CDATA[
SELECT 
    u.id,
    u.enabled,
    u.email,
    u.password,
    u.authority,
    u.firstname,
    u.lastname,
    u.address,
    u.city,
    u.zip,
    u.phone,
    u.country,
    u.birth_date,
    u.birth_place,
    u.current_position,
    u.department,
    u.driving_license,
    u.driving_license_emission,
    u.education,
    u.employee_identification,
    u.family_charge,
    u.fiscal_code,
    u.marital_status,
    u.nbudge,
    u.ncfl,
    u.npass,
    u.provincia,
    u.status,
    u.personal_code,
    u.sex,
    u.out_schedule,
    u.birth_province,
    u.dailyemployee,
    u.part_time,
    u.daywork_w,
    u.hourswork_w,
    u.contractual_level
FROM
    user u
WHERE
    u.email = #{username}
        AND u.password = #{password}
ORDER BY u.status ASC
]]>
	</select>





	<select id="selectAllPerson" resultType="org.uario.seaworkengine.model.Person">
<![CDATA[
SELECT 
    u.id,
    u.enabled,
    u.email,
    u.password,
    u.authority,
    u.firstname,
    u.lastname,
    u.address,
    u.city,
    u.zip,
    u.phone,
    u.country,
    u.birth_date,
    u.birth_place,
    u.current_position,
    u.department,
    u.driving_license,
    u.driving_license_emission,
    u.education,
    u.employee_identification,
    u.family_charge,
    u.fiscal_code,
    u.marital_status,
    u.nbudge,
    u.ncfl,
    u.npass,
    u.provincia,
    u.status,
    u.personal_code,
    u.sex,
    u.out_schedule,
    u.birth_province,
    u.dailyemployee,
    u.part_time,
    u.daywork_w,
    u.hourswork_w,
    u.contractual_level,
    (SELECT 
            GROUP_CONCAT(ut.description)
        FROM
            usertask ut,
            user_usertask u_t
        WHERE
            u.id = u_t.id_user
                AND u_t.id_usertask = ut.id
                AND ut.internal = 0) AS tasksPerson
FROM
    user u
ORDER BY u.status ASC
]]>
	</select>

	<select id="selectWorkerPersonForMobile" resultType="org.uario.seaworkengine.model.Person"
		parameterType="map">
<![CDATA[		
SELECT 
    u.id,
    u.enabled,
    u.email,
    u.password,
    u.authority,
    u.firstname,
    u.lastname,
    u.address,
    u.city,
    u.zip,
    u.phone,
    u.country,
    u.birth_date,
    u.birth_place,
    u.current_position,
    u.department,
    u.driving_license,
    u.driving_license_emission,
    u.education,
    u.employee_identification,
    u.family_charge,
    u.fiscal_code,
    u.marital_status,
    u.nbudge,
    u.ncfl,
    u.npass,
    u.provincia,
    u.status,
    u.personal_code,
    u.sex,
    u.out_schedule,
    u.birth_province,
    u.dailyemployee,
    u.part_time,
    u.daywork_w,
    u.hourswork_w,
    u.contractual_level
FROM
    user u,
    schedule s,
    usershift us
WHERE
   		u.status = 'IN ORGANICO'
        AND u.out_schedule = 0
        AND u.dailyemployee = 0
        AND u.dailyemployee = 0
        AND s.user = u.id
        AND s.date_schedule = #{date_scheudle}
        AND s.shift = us.id
        AND us.presence = 1
ORDER BY u.lastname ASC
]]>



	</select>

	<select id="selectWorkerPerson" resultType="org.uario.seaworkengine.model.Person"
		parameterType="map">
		
<![CDATA[		
SELECT 
    u.id,
    u.enabled,
    u.email,
    u.password,
    u.authority,
    u.firstname,
    u.lastname,
    u.address,
    u.city,
    u.zip,
    u.phone,
    u.country,
    u.birth_date,
    u.birth_place,
    u.current_position,
    u.department,
    u.driving_license,
    u.driving_license_emission,
    u.education,
    u.employee_identification,
    u.family_charge,
    u.fiscal_code,
    u.marital_status,
    u.nbudge,
    u.ncfl,
    u.npass,
    u.provincia,
    u.status,
    u.personal_code,
    u.sex,
    u.out_schedule,
    u.birth_province,
    u.dailyemployee,
    u.part_time,
    u.daywork_w,
    u.hourswork_w,
    u.contractual_level
FROM
    user u
WHERE
   		u.status = 'IN ORGANICO'
        AND u.out_schedule = 0
]]>
		<if test="my_full_text_search != null">
        <![CDATA[
        AND (u.firstname LIKE CONCAT('%', #{my_full_text_search}, '%')
        OR u.lastname LIKE CONCAT('%', #{my_full_text_search}, '%')
        OR u.employee_identification = #{my_full_text_search})
        ]]>
		</if>

		<if test="department != null">
         <![CDATA[
        AND u.department = #{department}
        ]]>
		</if>
<![CDATA[        
ORDER BY u.status ASC
]]>
	</select>


	<select id="selectAllPersonFulltextSearchLike" parameterType="map"
		resultType="org.uario.seaworkengine.model.Person">
<![CDATA[  
SELECT 
    u.id,
    u.enabled,
    u.email,
    u.password,
    u.authority,
    u.firstname,
    u.lastname,
    u.address,
    u.city,
    u.zip,
    u.phone,
    u.country,
    u.birth_date,
    u.birth_place,
    u.current_position,
    u.department,
    u.driving_license,
    u.driving_license_emission,
    u.education,
    u.employee_identification,
    u.family_charge,
    u.fiscal_code,
    u.marital_status,
    u.nbudge,
    u.ncfl,
    u.npass,
    u.provincia,
    u.status,
    u.personal_code,
    u.sex,
    u.out_schedule,
    u.birth_province,
    u.dailyemployee,
    u.part_time,
    u.daywork_w,
    u.hourswork_w,
    u.contractual_level,
    (SELECT 
            GROUP_CONCAT(ut.description)
        FROM
            usertask ut,
            user_usertask u_t
        WHERE
            u.id = u_t.id_user
                AND u_t.id_usertask = ut.id
                AND ut.internal = 0) AS tasksPerson
FROM
    user u
]]>
		<if test="my_full_text_search != null">
<![CDATA[  
WHERE
    (u.firstname LIKE CONCAT('%', #{my_full_text_search}, '%')
        OR u.lastname LIKE CONCAT('%', #{my_full_text_search}, '%')
        OR u.employee_identification = #{my_full_text_search})
]]>
		</if>
<![CDATA[ 
ORDER BY u.status ASC
]]>
	</select>

	<select id="selectSuspendedUsers" parameterType="string"
		resultType="org.uario.seaworkengine.model.Person">
<![CDATA[ 
SELECT 
    u.id,
    u.enabled,
    u.email,
    u.password,
    u.authority,
    u.firstname,
    u.lastname,
    u.address,
    u.city,
    u.zip,
    u.phone,
    u.country,
    u.birth_date,
    u.birth_place,
    u.current_position,
    u.department,
    u.driving_license,
    u.driving_license_emission,
    u.education,
    u.employee_identification,
    u.family_charge,
    u.fiscal_code,
    u.marital_status,
    u.nbudge,
    u.ncfl,
    u.npass,
    u.provincia,
    u.status,
    u.personal_code,
    u.sex,
    u.out_schedule,
    u.birth_province,
    u.dailyemployee,
    u.part_time,
    u.daywork_w,
    u.hourswork_w,
    u.contractual_level
FROM
    user u
WHERE
    u.status = #{idSuspended}
]]>
	</select>




	<select id="selectUserById" parameterType="int"
		resultType="org.uario.seaworkengine.model.Person">
<![CDATA[ 
SELECT 
    u.id,
    u.enabled,
    u.email,
    u.password,
    u.authority,
    u.firstname,
    u.lastname,
    u.address,
    u.city,
    u.zip,
    u.phone,
    u.country,
    u.birth_date,
    u.birth_place,
    u.current_position,
    u.department,
    u.driving_license,
    u.driving_license_emission,
    u.education,
    u.employee_identification,
    u.family_charge,
    u.fiscal_code,
    u.marital_status,
    u.nbudge,
    u.ncfl,
    u.npass,
    u.provincia,
    u.status,
    u.personal_code,
    u.sex,
    u.out_schedule,
    u.birth_province,
    u.dailyemployee,
    u.part_time,
    u.daywork_w,
    u.hourswork_w,
    u.contractual_level
FROM
    user u
WHERE
    u.id = #{id}
]]>
	</select>

	<insert id="insertPerson" parameterType="org.uario.seaworkengine.model.Person">
		INSERT INTO user
		(email,password,authority,firstname,
		lastname,
		address,
		city,
		zip,
		phone,
		country,
		enabled,
		status,
		ncfl,
		birth_place,
		birth_date,
		provincia,
		fiscal_code,
		marital_status,
		family_charge,
		employee_identification,
		education,
		driving_license,
		driving_license_emission,
		current_position,
		department,
		npass,
		nbudge,
		personal_code,
		sex,
		out_schedule,
		birth_province,
		dailyemployee,
		part_time,
		daywork_w,
		hourswork_w
		)
		VALUES
		(#{email},
		#{password},
		#{authority},
		#{firstname},
		#{lastname},
		#{address},
		#{city},
		#{zip},
		#{phone},
		#{country},
		#{enabled},
		#{status},
		#{ncfl},
		#{birth_place},
		#{birth_date},
		#{provincia},
		#{fiscal_code},
		#{marital_status},
		#{family_charge},
		#{employee_identification},
		#{education},
		#{driving_license},
		#{driving_license_emission},
		#{current_position},
		#{department},
		#{npass},
		#{nbudge},
		#{personal_code},
		#{sex},
		#{out_schedule},
		#{birth_province},
		#{dailyemployee},
		#{part_time},
		#{daywork_w},
		#{hourswork_w})
	</insert>

	<delete id="deletePerson" parameterType="int">
		delete from user where
		id = #{id}
	</delete>

	<update id="updatePerson" parameterType="org.uario.seaworkengine.model.Person">
		UPDATE user set
		enabled =
		#{enabled},
		authority = #{authority},
		firstname = #{firstname},
		lastname
		= #{lastname},
		address = #{address},
		city = #{city},
		zip = #{zip},
		phone =
		#{phone},
		country = #{country},
		birth_date = #{birth_date},
		birth_place =
		#{birth_place},
		current_position =
		#{current_position},
		department =
		#{department},
		driving_license =
		#{driving_license},
		driving_license_emission =
		#{driving_license_emission},
		education =
		#{education},
		employee_identification = #{employee_identification},
		family_charge =
		#{family_charge},
		fiscal_code = #{fiscal_code},
		marital_status =
		#{marital_status},
		nbudge = #{nbudge},
		ncfl = #{ncfl},
		npass =
		#{npass},
		provincia = #{provincia},
		status = #{status},
		personal_code = #{personal_code},
		sex = #{sex},
		out_schedule =
		#{out_schedule},
		birth_province =
		#{birth_province},
		dailyemployee =
		#{dailyemployee},
		part_time =
		#{part_time},daywork_w = #{daywork_w},
		hourswork_w = #{hourswork_w},
		contractual_level = #{contractual_level}
		WHERE id =
		#{id}
	</update>

	<update id="changeMail" parameterType="org.uario.seaworkengine.model.Person">
		UPDATE user set
		email =
		#{email},
		password = #{password}
		WHERE id = #{id}
	</update>

	<update id="changePassword" parameterType="org.uario.seaworkengine.model.Person">
		UPDATE user set
		password = #{password}
		WHERE id = #{id}
	</update>

	<select id="loadCodComune" parameterType="map" resultType="String">
		select codice
		from comuni
		where comune=#{comune} and
		provincia=#{provincia};
	</select>

	<select id="loadAllProvincia" resultType="String">
		select DISTINCT
		provincia
		from comuni
		order by provincia asc;
	</select>



	<select id="loadComuniByProvincia" resultType="String"
		parameterType="String">
		select comune
		from comuni
		where provincia=#{provincia}
		order by comune asc;
	</select>





</mapper>